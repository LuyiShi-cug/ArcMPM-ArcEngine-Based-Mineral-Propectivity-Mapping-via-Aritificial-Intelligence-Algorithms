
<style>
.center { text-align: center; }
</style>
<h1 class="center">ArcMPM V2.0操作手册</h1>

[TOC]

# 1 软件介绍

智能矿产预测软件（ArcMPM；即ArcEngine-based software for mineral prospectivity mapping (MPM) via artificial intelligence (AI) algorithms）借助ArcEngine平台，使用C#语言以及Python语言开发的一款软件。它主要包括地质数据可视化、负样本选择、样本制作、地球化学智能识别和矿产资源潜力评价等功能，旨在提供智能矿产预测的完整流程。

# 2 安装与卸载

## 2.1 软件运行条件

本软件为基于ArcEngine平台开发的应用程序，运行环境的操作系统为Windows 7及以上版本的系统。另外，需要安装不低于ArcGIS 10.2 for Desktop版本的License。

## 2.2 软件安装过程

（1）首先打开软件安装包ArcMPM.msi（图 1），根据安装向导下一步

![placeholder](/figure/1.png)
图 1安装包

（2）选择安装文件夹选择完成后点击下一步（图 2）

（3）随后下一步继续安装（图 3）

（4）等待软件安装完成关闭即可

（5）将提前下载的Python3.9压缩包解压到ArcMPM的安装路径（图 4）

（6）软件安装成功，运行软件ArcMPM。打开软件后，软件为英文版，倘若要切换为中文，点击【Help】→【Change to Chinese】即可切换为中文界面（图 5）

![placeholder](/figure/2.png)
图 2选择安装路径

![placeholder](/figure/3.png)
图 3安装进度

![placeholder](/figure/4.png)
图 4放置Python39文件夹

![placeholder](/figure/5.png)
图 5软件界面

## 2.3 软件卸载

点击目录中的Unistall.exe，选择【是】即可开始删除，同时手动删除文件夹中的Python3.9文件夹，即可完全删除（图 6）。

![placeholder](/figure/6.png)
图 6卸载软件

# 3 数据加载

点击【文件】→【打开Mxd文件】可选择打开地图文档；点击【文件】→【打开Shp文件】、【文件】→【打开Tif文件】、【文件】→【打开Grid文件】，可以通过这些方式来添加数据；也可以通过![placeholder](/figure/openfileico.png)来打开地图文档和添加数据。

在此以打开地图文档为例。点击【文件】→【打开Mxd文件】。在弹出的对话框中选择地图文档后点击打开即可（图 7）。

![placeholder](/figure/7.png)
图 7数据加载

# 4样本制作

## 4.1 负样本点选取

点击【样本制作】→【负样本点制作】，弹出负样本选取界面（图 8）。

![placeholder](/figure/8.png)
图 8负样本选取界面

- 正样本路径：使用已知矿点作为正样本。可通过下拉框来添加已经加载入软件中的Shp文件；也可以通过点击![placeholder](/figure/openfileico.png)按钮来选择文件
- 处理范围：为整个研究区的研究范围，该数据应包括研究区的边界以及坐标信息，需要使用栅格数据作为该输入。在本实例中采用该研究区证据图层中任意一个即可，可通过下拉框选择已载入软件的栅格数据，也可以通过![placeholder](/figure/openfileico.png)按钮来选择文件
- 约束区域：为约束负样本出现的区域，对制作的负样本位置进行限制。可通过下拉框选择已载入软件的数据，也可以通过![placeholder](/figure/openfileico.png)按钮来选择文件
- 约束区域集合：为限制负样本出现的区域的集合。在确定约束区域后，点击【↓】按钮来将该限制区域添加入集合，默认负样本出现的位置与限制区域距离为1000米；如果要移除集合中某一项，则选择该整行点击【×】按钮来将其移除集合；如果要修改与约束区域距离，则点击该行该列的距离，随后输入理想的距离单位为米
- 负样本输出路径：选择生成的负样本文件的路径，输出的样本文件为shp文件。通过点击![placeholder](/figure/openfileico.png)来选择文件目录

所有参数输入完毕后点击【生成负样本】，等待制作完成即可负样本点选取。制作完成的负样本点会被直接载入到软件中（图 9）。

![placeholder](/figure/9.png)
图 9负样本展示

## 4.2 训练样本制作

倘若后续需要进行地球化学异常识别，控矿图层的输入应为地球化学数据；反之，如果需要进行矿产资源潜力评价，控矿图层的输入可以包括各种来源的找矿大数据，但其数据形式需要为范围及栅格大小相同的栅格图层。

### 4.2.1 有监督学习样本制作

选择【样本制作】→【训练样本制作】→【有监督学习样本】，即可打开有监督学习样本制作界面（图 10）。

![placeholder](/figure/10.png)
图 10有监督学习样本制作界面

- 正样本图层：使用已知矿点作为正样本。可通过下拉框来添加已经加载入软件中的shp文件；也可以通过点击按钮来选择文件
- 负样本图层：为【样本制作】→【负样本制作】中生成的负样本。可通过下拉框直接选择负样本，也可以通过点击按钮来选择文件
- 控矿图层：为与控矿因素相关的图层，数据类型为栅格图层。可通过下拉框来添加已经加载入软件中的栅格文件，也可以通过点击按钮来选择文件
- 控矿图层集合：为与控矿因素相关的图层的集合。该界面会默认加载软件中已载入的栅格数据作为证据图层进入该列表中；用户也可以通过来自行加载或删除数据
- 数据增强窗口大小：用于进行数据增强的窗口大小，输入数据类型应为奇数整数
- 样本窗口大小：倘若需要构建用于卷积神经网络训练的样本，需勾选该项，并输入所需构建的样本窗口大小，输入数据类型应为奇数整数
- 构图距离阈值：倘若需要构建用于图神经网络训练的样本，需勾选该项，并输入用于构建拓扑图的欧氏距离，输入数据类型应为整数
- 生成数据目录：在选择的目录中生成有监督学习训练所需的样本（推荐使用空的文件夹）。通过来选择![placeholder](/figure/openfileico.png)文件目录

所有参数输入完成后，点击【生成】，即可在指定目录生成样本（图 11）。生成成功后，会弹出样本制作成功的提示。

![placeholder](/figure/11.png)
图 11有监督学习样本

### 4.2.2 无监督学习样本制作

选择【样本制作】→【训练样本制作】→【无监督学习样本】，即可打开无监督学习样本制作界面（图 12）。

![placeholder](/figure/12.png)
图 12无监督学习样本制作窗口

- 控矿图层：为与控矿因素相关的图层，数据类型为栅格图层。可通过下拉框来添加已经加载入软件中的栅格文件，也可以通过点击按钮来选择文件
- 控矿图层集合：为与控矿因素相关的图层的集合。该界面会默认加载软件中已载入的栅格数据作为证据图层进入该列表中；用户也可以通过来自行加载或删除数据
- 样本窗口大小：倘若需要构建用于卷积神经网络训练的样本，需勾选该项，并输入所需构建的样本窗口大小，输入数据类型应为奇数整数
- 构图距离阈值：倘若需要构建用于图神经网络训练的样本，需勾选该项，并输入用于构建拓扑图的欧氏距离，输入数据类型应为整数
- 生成数据目录：在选择的目录中生成无监督学习训练所需的样本（推荐使用空的文件夹）。通过来选择![placeholder](/figure/openfileico.png)文件目录

所有参数输入完成后，点击【生成】，即可在指定目录生成样本。生成成功后，会弹出样本制作成功的提示（图 13）。

![placeholder](/figure/13.png)
图 13无监督学习样本

# 5 地球化学异常识别

## 5.1 空谱双分支模型

选择【地球化学异常识别】→【空谱双分支监督学习模型】，即可打开双分支模型构建界面（图 14）。

![placeholder](/figure/14.png)
图 14空谱双分支模型构建界面-模型训练

- 加载数据集：为有监督学习样本制作所生成数据的目录，这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 损失函数：用来估量模型的预测值与真实值的不一致程度，损失函数越小，一般就代表模型的鲁棒性越好，损失函数指导了模型的学习。软件提供交叉熵损失函数，用户无需调整
- 迭代次数：为模型训练的迭代次数，输入数据类型应为整数，用户可自行调节
- 学习率：运用梯度下降算法进行优化时，在权重的更新规则中，梯度项前会乘以一个系数，这个系数就叫学习率。输入数据类型为非零小数，用户可自行调节
- 优化器类型：为模型训练时所选取的优化器类型。软件仅提供Adam，用户无需调整
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入

完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。

在此使用自定义网络层次进行模型训练作为示例点击【模型结构设置】（图 15）。在空谱双分支网络设置时，应优先设置空间分支与谱分支的模型结构，最后设置融合模型的结构。其中“窗口大小”参数为样本制作时所设置的“窗口大小”，需要用户根据实际制作的样本窗口大小进行调整

![placeholder](/figure/15.png)
图 15空谱双分支模型构建界面-空间模型结构设置

在空间分支模型中可选择的网络层如下：

- 二维卷积神经网络（2DCNN）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择
  - 填充：该参数为卷积运算前数据周围填充的层数。用户可根据需要自行设置
  - 卷积核大小：该参数为在进行卷积运算时的卷积核大小。用户可根据需要自行设置
  - 步长：该参数为进行卷积运算时卷积核移动距离。用户可根据需要自行设置
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节

- 池化层（Pooling）：
  - 池化类型：软件提供平均池化（AveragePooling）和最大值池化（MaxPooling）两种池化层类型。用户可根据需要自行选择
  - 池化尺寸：该参数为池化层的窗口大小。数据类型为整数，用户可根据需要自行调节
  - 池化层步长：该参数为池化层的窗口在数据上运动的步长。数据类型为整数，用户可根据需要自行调节

- 图卷积层（GCN）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择。
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节。

- 图注意力层（GAT）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择。
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节。
  - 注意力头数：该参数为图注意力层中的注意力头数。数据类型为整数，用户可根据需要自行调节。

![placeholder](/figure/16.png)
图 16空谱双分支模型构建界面-谱模型结构设置

在谱分支中提供的网络层如下（图 16）：

- 一维卷积神经网络（1DCNN）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择。
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节。

- 循环神经网络（RNN）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择。
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节。
  - 模型类型：在此可选择添加到模型的RNN层类型，软件提供原始RNN、长短时记忆网络（LSTM）和门控循环神经网络（GRU）三种。用户可根据需求使用下拉框自行选择。

- 全连接层（Linear）：
  - 输入维度：第一层输入数据应与地球化学元素种类数一致，为软件自动计算无需手动调整
  - 输出维度：用户根据需要自行设置该层输出维度。数据类型应为整数
  - 激活函数：软件提供ReLU和GELU两种激活函数。用户可通过下拉框自行选择。
  - 失活率：在该层后加上Dropout层使一定比例的神经元失活。数据类型为0到1间小数，用户可根据需要自行调节。

![placeholder](/figure/17.png)
图 17空谱双分支模型构建界面-融合模型结构设置

融合模型仅有全连接层能够选择（图 17），在融合模型中，建议将失活率设置为0，且最后一层的输出维度应设置为2，激活函数设置为softmax。

 所有网络设置完成后，点击【确定】，即可使用该网络结构进行训练。点击【模型训练】，弹出训练进度条。当训练完成后，弹出训练过程中的损失图和准确率图（图 18）。

![placeholder](/figure/18.png)
图 18空谱双分支模型训练过程图

关闭空谱双分支模型训练过程图后，弹出该模型的各项评价指标图（图 19），包括“Accuracy”，“Precision”，“Recall”，“F1 Score”，“ROC-AUC”。

![placeholder](/figure/19.png)
图 19空谱双分支模型各项评价指标

关闭空谱双分支模型各项评价指标后，将使用该模型进行预测，并将预测结果直接加载到软件中（图 20），并且在训练过程中所生成的各种图件以及模型将被保存在“模型保存路径”中。

![placeholder](/figure/20.png)
图 20空谱双分支模型结果图

## 5.2 空谱自编码器模型

选择【地球化学异常识别】→【空谱双分支自编码器模型】，即可打开双分支自编码器构建界面（图 21）。

![placeholder](/figure/21.png)
图 21空谱双分支自编码器构建界面

- 加载数据集：为无监督学习样本制作所生成数据的目录，这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 损失函数：用来估量模型的预测值与真实值的不一致程度，损失函数越小，一般就代表模型的鲁棒性越好，损失函数指导了模型的学习。软件仅提供均方根误差损失函数，用户无需调整
- 迭代次数：为模型训练的迭代次数，输入数据类型应为整数，用户可自行调节
- 学习率：运用梯度下降算法进行优化时，在权重的更新规则中，梯度项前会乘以一个系数，这个系数就叫学习率。输入数据类型为非零小数，用户可自行调节
- 优化器类型：为双分支模型训练时所选取的优化器类型。软件仅提供Adam，用户无需调整
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入

完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。在该界面中用户可根据需求自定义空间分支模型和谱分支模型中的编码器网络结构。模型将根据用户输入的编码器结构自动生成相应的解码器结构。模型所提供的网络层类型与双分支网络中的网络层类型一致，并且操作一致，在此不做赘述。

 所有网络设置完成后，点击【确定】，即可使用该网络结构进行训练。点击【模型训练】，弹出训练进度条。当训练完成后，将使用该模型进行预测，并将预测结果直接加载到软件中（图 22），并且在训练过程中所生成的模型和结果图将被保存在“模型保存路径”中。

![placeholder](/figure/22.png)
图 22空谱双分支自编码器结果图

# 6 矿产资源潜力评价

## 6.1 监督学习方法

### 6.1.1 随机森林

点击【矿产资源潜力评价】→【监督学习算法】→【随机森林】，弹出随机森林构建窗口（图 23）。

![placeholder](/figure/23.png)
图 23随机森林构建界面

- 加载数据集：为有监督学习样本制作所生成数据的目录，这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 划分训练集验证集：通过下拉框选择训练集测试集划分比例
- 决策树数量：随机森林所建决策树树的数量。输入数据类型为整数，用户可自行调节
- 最大深度：树的最大深度。输入数据类型为整数，用户可自行调节
- 最大特征数：每棵树所用到的最大特征数量。通过下拉框选择，或者手动输入0到1的小数
- 评估标准：本软件提供gini和entropy两种方式，通过下拉框选择
- 叶子节点的最小样本数：输入数据类型为整数，用户可自行调节
- 节点最少划分样本数量：输入数据类型为整数，用户可自行调节
- 模型输出路径：训练所得模型的输出路径，通过![placeholder](/figure/openfileico.png)按钮来选择文件
- 生成模型文件名：训练所得模型的文件名，可使用默认文件名或用户自行输入

完成参数设置后，点击【模型训练】按钮即可开始训练随机森林的模型。训练完成后弹出各项评价指标（图 24）。关闭该窗口后，即可生成结果图，并直接加载到软件中（图 25）

![placeholder](/figure/24.png)
图 24随机森林各项评价指标

![placeholder](/figure/25.png)
图 25随机森林预测结果图

### 6.1.2 卷积神经网络

点击【矿产资源潜力评价】→【监督学习算法】→【卷积神经网络】，打开卷积神经网络模型构建窗口（图 26）。

![placeholder](/figure/26.png)
图 26卷积神经网络模型构建界面-模型训练

- 加载数据集：为有监督学习样本制作所生成数据的目录（需勾选“样本窗口大小”），这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 损失函数：用来估量模型的预测值与真实值的不一致程度，损失函数越小，一般就代表模型的鲁棒性越好，损失函数指导了模型的学习。软件提供交叉熵损失函数，用户无需调整
- 迭代次数：为模型训练的迭代次数，输入数据类型应为整数，用户可自行调节
- 学习率：运用梯度下降算法进行优化时，在权重的更新规则中，梯度项前会乘以一个系数，这个系数就叫学习率。输入数据类型为非零小数，用户可自行调节
- 优化器类型：为训练时所选取的优化器类型。软件提供Adam，用户无需调整
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入

完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。

在此使用自定义网络层次进行模型训练作为示例点击【模型结构设置】（图 27）。在网络设计时，应注意首先设置卷积层和池化层进行空间特征提取，随后再添加全连接层进行分类。最后一层必须是全连接层，输出维度为2且激活函数为softmax。其中“窗口大小”参数为样本制作时所设置的“窗口大小”，需要用户根据实际制作的样本窗口大小进行调整。其中所使用到的模型参数参照5.1内有关卷积层和全连接层的解释。

![placeholder](/figure/27.png)
图 27卷积神经网络构建界面-模型结构设计

设计完成后，点击【确定】保存模型结构，随后点击【模型训练】即可使用自定义网络层进行训练和预测。当训练完成后，弹出训练过程中的损失图和准确率图。

![placeholder](/figure/28.png)
图 28卷积神经网络训练过程图

关闭卷积神经网络训练过程图后，弹出该模型的各项评价指标图，包括“Accuracy”，“Precision”，“Recall”，“F1 Score”，“ROC-AUC”。

![placeholder](/figure/29.png)
图 29卷积神经网络各项评价指标

关闭卷积神经网络各项评价指标后，将使用该模型进行预测，并将预测结果直接加载到软件中，并且在训练过程中所生成的各种图件以及模型将被保存在“模型保存路径”中。

![placeholder](/figure/30.png)
图 30卷积神经网络结果图

### 6.1.3 图神经网络

点击【矿产资源潜力评价】→【监督学习算法】→【图神经网络】，打开图神经网络模型构建窗口（图31）。

![placeholder](/figure/31.png)
图 31图神经网络模型构建界面-模型训练

- 加载数据集：为有监督学习样本制作所生成数据的目录（需勾选“构图距离阈值”），这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 损失函数：用来估量模型的预测值与真实值的不一致程度，损失函数越小，一般就代表模型的鲁棒性越好，损失函数指导了模型的学习。软件仅提供交叉熵损失函数，用户无需调整
- 迭代次数：为模型训练的迭代次数，输入数据类型应为整数，用户可自行调节
- 学习率：运用梯度下降算法进行优化时，在权重的更新规则中，梯度项前会乘以一个系数，这个系数就叫学习率。输入数据类型为非零小数，用户可自行调节
- 优化器类型：为模型训练时所选取的优化器类型。软件仅提供Adam，用户无需调整
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入

完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。

在此使用自定义网络层次进行模型训练作为示例点击【模型结构设置】（图 32）。在网络设计时，应注意首先设置图卷积层或图注意力层进行空间特征提取，随后再添加全连接层进行分类。最后一层必须是全连接层，输出维度为2且激活函数为softmax。其中所使用到的模型参数参照5.1内有关解释。

![placeholder](/figure/32.png)
图 32图神经网络模型构建-模型结构设置

设计完成后，点击【确定】保存模型结构，随后点击【模型训练】即可使用自定义网络层进行训练和预测，并弹出训练进度条。当训练完成后，弹出训练过程中的损失图和准确率图。

![placeholder](/figure/33.png)
图 33图神经网络训练过程图

关闭图神经网络训练过程图后，弹出该模型的各项评价指标图，包括“Accuracy”，“Precision”，“Recall”，“F1 Score”，“ROC-AUC”。

![placeholder](/figure/34.png)
图 34图神经网络各项评价指标

关闭图神经网络各项评价指标后，将使用该模型进行预测，并将预测结果直接加载到软件中，并且在训练过程中所生成的各种图件以及模型将被保存在“模型保存路径”中。

![placeholder](/figure/35.png)
图 35图神经网络结果图

## 6.2 自监督学习方法

### 6.2.1 图自监督网络

点击【矿产资源潜力评价】→【自监督学习算法】→【图自监督网络】，打开图自监督网络模型构建窗口（图36）。

![placeholder](/figure/36.png)
图 36图自监督网络构建界面-模型训练

- 加载数据集：为有监督学习样本制作所生成数据的目录（需勾选“构图距离阈值”），这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入·
- 自监督预训练阶段超参数设置迭代次数：为模型自监督预训练的迭代次数，输入数据类型应为整数，用户可自行调节
- 预训练模型学习率：自监督学习阶段，预训练模型的学习率。输入数据类型为非零小数，用户可自行调节
- 掩码比例：生成掩码图时，对边进行随机掩码的比例。输入数据类型为0到1的小数，用户可自行调节
- 掩码图个数：生成掩码图的数量，输入数据为整数，用户可自行调节

- 微调阶段超参数设置
  - 迭代次数：为模型微调阶段的迭代次数，输入数据类型应为整数，用户可自行调节
  - 预训练模型学习率：微调阶段，预训练模型的学习率。输入数据类型为非零小数，用户可自行调节
  - 分类器学习率：微调阶段，分类器的学习率。输入数据类型为非零小数，用户可自行调节


其中，在自监督学习阶段，采用的损失函数为对比损失；微调阶段，采用的损失函数为交叉熵损失。完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。

在此使用自定义网络层次进行模型训练作为示例点击【模型结构设置】（图 37）。在网络设计时，应注意首先设置图卷积层或图注意力层进行空间特征提取，也就是预训练模型；随后再添加全连接层作为分类器。最后一层必须是全连接层，输出维度为2且激活函数为softmax。其中所使用到的模型参数参照5.1内有关解释。

![placeholder](/figure/37.png)
图 37图自监督网络构建界面-模型结构设置

设计完成后，倘若需要添加地质约束，则点击【添加地质约束】，弹出添加地质约束界面，在此位置添加地质约束图层，并设置对应损失权重（0到1的小数）。

![placeholder](/figure/38.png)
图 38添加地质约束

设置完成后点击【确定】保存，再从模型结构设置界面点击【确定】，即可完成模型结构设计与添加地质约束。随后点击【模型训练】即可使用自定义网络层进行训练和预测，并弹出训练进度条。进度条过50％时，预训练结束，弹出预训练阶段损失图，关闭后该窗口后，开始微调。当训练全部完成后，弹出训练过程中的损失图和准确率图。

![placeholder](/figure/39.png)
图 39图自监督网络预训练过程图

![placeholder](/figure/40.png)
图 40图自监督网络微调过程图

关闭图自监督网络训练过程图后，弹出该模型的各项评价指标图，包括“Accuracy”，“Precision”，“Recall”，“F1 Score”，“ROC-AUC”。

![placeholder](/figure/41.png)
图 41图自监督网络各项评价指标

关闭图自监督网络各项评价指标后，将使用该模型进行预测，并将预测结果直接加载到软件中，并且在训练过程中所生成的各种图件以及模型将被保存在“模型保存路径”中。

![placeholder](/figure/42.png)
图 42图自监督网络结果图

## 6.3 强化学习方法

### 6.3.1 图强化学习算法

点击【矿产资源潜力评价】→【强化学习算法】→【图强化学习算法】，打开图自监督网络模型构建窗口（图43）。

![placeholder](/figure/43.png)
图 43图强化学习网络构建界面-模型训练

- 加载数据集：为有监督学习样本制作所生成数据的目录，这里需要选择存放数据的文件路径，可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 地球化学异常图：为地球化学异常图的路径。可通过下拉框选择已载入软件的图层，也可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 模型保存路径：为训练所得模型的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径
- 模型文件名：为训练所得模型的文件名，用户可自行输入
- 训练超参数设置
- 轨迹条数：为强化学习阶段，选择轨迹的总次数。输入数据类型应为整数，用户可自行调节
- 构图邻居数：为每个节点构图时所连接的邻居数，输入数据类型应为整数，用户可自行调节
- 学习率：策略模型的学习率。输入数据类型为非零小数，用户可自行调节
- 批处理数量：为训练策略网络时，一次性输入拓扑图的数量。输入数据类型为非零小数，用户可自行调节
- 轨迹长度：为强化学习阶段，每次选择轨迹时的轨迹长度。输入数据类型应为整数，用户可自行调节
- 批处理次数：为训练策略网络时，输入拓扑图的次数。输入数据类型为非零小数，用户可自行调节
- 探索距离阈值：为强化学习阶段，生成轨迹时模型每次探索的最远距离。输入数据类型为非零小数，用户应根据自身数据情况进行调整

完成参数设置后，可直接点击【模型训练】，使用默认网络结构进行训练和预测；也可以点击【模型结构设置】来实现自定义网络结构。

在此使用自定义网络层次进行模型训练作为示例点击【模型结构设置】（图 44）。在网络设计时，应注意首先设置图卷积层或图注意力层进行空间特征提取，随后再添加全连接层作为分类器。最后一层必须是全连接层，输出维度为2且激活函数为softmax。其中所使用到的模型参数参照5.1内有关解释。

![placeholder](/figure/44.png)
图 44图强化学习网络构建界面-模型结构设置

设计完成后，倘若需要添加地质约束，则点击【添加地质约束】，弹出添加地质约束界面，在此位置添加地质约束图层，并设置对应损失权重（0到1的小数）。

![placeholder](/figure/45.png)
图 45添加地质约束

设置完成后点击【确定】保存，再从模型结构设置界面点击【确定】，即可完成模型结构设计与添加地质约束。随后点击【模型训练】即可使用自定义网络层进行训练和预测，并弹出训练进度条。强化学习训练过程较为缓慢，共分为生成强化学习数据、强化学习和预测三个阶段，期间软件会处于无响应，请不要关闭。训练完成后，生成训练过程图（图 46）。

![placeholder](/figure/46.png)
图 46图强化学习网络训练过程图

关闭图强化学习网络训练过程图后，将使用该模型进行预测，并将预测结果直接加载到软件中，并且在训练过程中所生成的各种图件以及模型将被保存在“模型保存路径”中。

![placeholder](/figure/47.png)
图 47图强化学习网络结果图

# 7 其他

## 7.1 评价曲线

 点击【帮助】→【模型评价曲线】，弹出评价曲线界面。

![placeholder](/figure/48.png)
图 48评价曲线界面

- 正样本图层：使用已知矿点作为正样本。在本实例中采用Fe_deposits.shp为正样本数据，可通过下拉框来添加已经加载入软件中的shp文件；也可以通过点击按钮来选择文件
- 结果图：为结果图（包括地球化学异常图和矿产远景图）的路径。可通过下拉框选择已载入软件的图层，也可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 结果图列表：存储添加结果图的路径。该界面会默认加载软件中已载入的栅格数据作为图层进入该列表中；用户也可以通过来自行加载或删除数据
- 保存路径：为评价曲线的保存路径，可通过![placeholder](/figure/openfileico.png)来选择模型保存路径

全部参数设置完成后，点击【确定】即可生成评价曲线：受试者工作特征曲线（ROC），和成功率曲线。曲线和生成曲线的表格数据会被存储在保存路径中。

![placeholder](/figure/49.png)

图 49评价曲线

## 7.2 制作地质约束图层

 点击【帮助】→【制作地质约束图层】，弹出评价曲线界面。

![placeholder](/figure/50.png)
图 50地质约束图层制作界面

- 正样本图层：使用已知矿点作为正样本。在本实例中采用Fe_deposits.shp为正样本数据，可通过下拉框来添加已经加载入软件中的shp文件；也可以通过点击按钮来选择文件
- 控矿地质实体：为控矿地质实体的路径。可通过下拉框选择已载入软件的图层，也可通过![placeholder](/figure/openfileico.png)来选择文件路径
- 处理范围：为整个研究区的研究范围，该数据应包括研究区的边界以及坐标信息，需要使用栅格数据作为该输入。在本实例中采用该研究区证据图层中任意一个即可，可通过下拉框选择已载入软件的栅格数据，也可以通过![placeholder](/figure/openfileico.png)按钮来选择文件
- 地质约束图层输出路径：为地质约束图层的保存路径，可通过![placeholder](/figure/openfileico.png)来选择路径
- 地质约束图层输出名称：为输出图层的名称，用户可自行设计

全部参数设置完成后，点击【确定】即可地质约束图层。生成完成后，将输出幂指曲线和约束图层，并存储在相应路径。

![placeholder](/figure/51.png)
图 51拟合幂指曲线

![placeholder](/figure/52.png)
图 52地质约束图层展示
